<?xml version="1.0" encoding="utf-8"?>
<DataSchemaModel FileFormatVersion="1.2" SchemaVersion="2.9" DspName="Microsoft.Data.Tools.Schema.Sql.Sql130DatabaseSchemaProvider" CollationLcid="1033" CollationCaseSensitive="False" xmlns="http://schemas.microsoft.com/sqlserver/dac/Serialization/2012/02">
	<Header>
		<CustomData Category="AnsiNulls">
			<Metadata Name="AnsiNulls" Value="True" />
		</CustomData>
		<CustomData Category="QuotedIdentifier">
			<Metadata Name="QuotedIdentifier" Value="True" />
		</CustomData>
		<CustomData Category="CompatibilityMode">
			<Metadata Name="CompatibilityMode" Value="130" />
		</CustomData>
		<CustomData Category="Reference" Type="Assembly">
			<Metadata Name="LogicalName" Value="appSocialNetwork.repositories.dll" />
			<Metadata Name="FileName" Value="C:\USERS\LUNA.LOISEL\DESKTOP\COURS MINES ALES\APPSOCIALNETWORK.REPOSITORIES\APPSOCIALNETWORK.REPOSITORIES\OBJ\DEBUG\APPSOCIALNETWORK.REPOSITORIES.DLL" />
			<Metadata Name="AssemblyName" Value="appSocialNetwork.repositories" />
			<Metadata Name="PermissionSet" Value="SAFE" />
			<Metadata Name="Owner" Value="" />
			<Metadata Name="GenerateSqlClrDdl" Value="True" />
			<Metadata Name="IsVisible" Value="True" />
			<Metadata Name="IsModelAware" Value="True" />
			<Metadata Name="SkipCreationIfEmpty" Value="True" />
			<Metadata Name="AssemblySymbolsName" Value="C:\Users\luna.loisel\Desktop\cours mines ales\appSocialNetwork.repositories\appSocialNetwork.repositories\obj\Debug\appSocialNetwork.repositories.pdb" />
		</CustomData>
		<CustomData Category="SqlCmdVariables" Type="SqlCmdVariable" />
	</Header>
	<Model>
		<Element Type="SqlDatabaseOptions">
			<Property Name="Collation" Value="SQL_Latin1_General_CP1_CI_AS" />
			<Property Name="IsAnsiNullDefaultOn" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Property Name="IsAnsiWarningsOn" Value="True" />
			<Property Name="IsArithAbortOn" Value="True" />
			<Property Name="IsConcatNullYieldsNullOn" Value="True" />
			<Property Name="IsTornPageProtectionOn" Value="False" />
			<Property Name="IsFullTextEnabled" Value="True" />
			<Property Name="PageVerifyMode" Value="3" />
			<Property Name="DefaultLanguage" Value="" />
			<Property Name="DefaultFullTextLanguage" Value="" />
			<Property Name="QueryStoreStaleQueryThreshold" Value="367" />
			<Relationship Name="DefaultFilegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[products].[idProduct]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="3" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[users].[idUser]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="4" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Followers_User]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="5" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Followers_User_2]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="6" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Purchases_Products]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="7" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[dbo].[FK_Purchases_Users]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="8" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[followers]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[followers].[idUser]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[followers].[idFollower]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="9" />
			<AttachedAnnotation Disambiguator="5" />
			<AttachedAnnotation Disambiguator="6" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GenerateRandomBuyings]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
	
    DECLARE @num_links INT;
	DECLARE @counter INT = 0;
	DECLARE @done bit = 0;
	DECLARE @user_id INT;
	DECLARE @product_id INT;
	DECLARE @already_set_ids VARCHAR(255) = '';
 
	-- Déclare un curseur pour parcourir la table dans l'ordre
	DECLARE users_cursor CURSOR FOR SELECT idUser FROM users u where idUser not in (select idUser from purchases) ORDER BY idUser ASC;

	-- Ouvre le curseur et commence le parcours
	OPEN users_cursor;
	FETCH NEXT from users_cursor INTO @user_id;

	WHILE @@FETCH_STATUS =0
	BEGIN

		SET @num_links = FLOOR(RAND() * 6); -- Génère un nombre aléatoire entre 0 et 20
		set @counter = 0;
		set @already_set_ids = '';

  		WHILE @counter < @num_links 
		BEGIN
			-- Sélectionne deux identifiants de lignes au hasard dans chaque table
			SELECT TOP 1 @product_id = idProduct FROM products p ORDER BY  NEWID();
	
			-- Insère la liaison entre les deux identifiants sélectionnés
			IF CHARINDEX(CONVERT(VARCHAR(10), @product_id), @already_set_ids) =0
			BEGIN
	    		SET @already_set_ids = CONCAT(@already_set_ids, ',', @product_id);
				INSERT INTO purchases (idUser, idProduct) VALUES (@user_id, @product_id);
			END
	    
			SET @counter += 1;
  		END
		FETCH NEXT from users_cursor INTO @user_id;

	END

	-- Ferme le curseur
	CLOSE users_cursor;
	DEALLOCATE users_cursor;

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="211" />
				<Property Name="Length" Value="1618" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 03/03/2023&#xD;&#xA;-- Description: generate random buyings link in purchases&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[GenerateRandomBuyings]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GenerateRandomFollowers]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
	
    DECLARE @num_links INT;
	DECLARE @counter INT = 0;
	DECLARE @done bit = 0;
	DECLARE @current_id INT;
	DECLARE @follower_id INT;
	DECLARE @already_set_ids VARCHAR(255) = '';
 
	-- Déclare un curseur pour parcourir la table dans l'ordre
	DECLARE users_cursor CURSOR FOR SELECT idUser FROM users u where idUser not in (select idUser from followers) ORDER BY idUser ASC;

	-- Ouvre le curseur et commence le parcours
	OPEN users_cursor;
	FETCH NEXT from users_cursor INTO @current_id;

	WHILE @@FETCH_STATUS =0
	BEGIN

		SET @num_links = FLOOR(RAND() * 21); -- Génère un nombre aléatoire entre 0 et 20
		set @counter = 0;
		set @already_set_ids = '';

  		WHILE @counter < @num_links 
		BEGIN
			-- Sélectionne deux identifiants de lignes au hasard dans chaque table
			SELECT TOP 1 @follower_id = idUser FROM users u where idUser != @current_id ORDER BY  NEWID();
	
			-- Insère la liaison entre les deux identifiants sélectionnés
			IF CHARINDEX(CONVERT(VARCHAR(10), @follower_id), @already_set_ids) =0
			BEGIN
	    		SET @already_set_ids = CONCAT(@already_set_ids, ',', @follower_id);
	    		INSERT INTO followers (idFollower, idUser) VALUES (@follower_id, @current_id);
			END
	    
			SET @counter += 1;
  		END
		FETCH NEXT from users_cursor INTO @current_id;

	END

	-- Ferme le curseur
	CLOSE users_cursor;
	DEALLOCATE users_cursor;

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="214" />
				<Property Name="Length" Value="1667" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: generate random followers link between users&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[GenerateRandomFollowers]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GetInfluence]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;
	
	WITH FollowerCTE AS
	(
		-- On démarre avec le user de base
		SELECT F1.*, 1 AS Niveau
		FROM Followers F1
		WHERE F1.idUser = @idInfluencer

		UNION ALL

		SELECT F2.*, Niveau+1
		FROM Followers F2
		INNER JOIN FollowerCTE follows ON follows.idFollower = F2.idUser
		WHERE Niveau < @profondeur
	)

	SELECT DISTINCT P.*, COUNT(P.IdProduct) as 'count'
    FROM Products P
    JOIN Purchases Pr on Pr.IdProduct = P.IdProduct
    WHERE Pr.idUser IN (
		SELECT DISTINCT idFollower FROM FollowerCTE
		WHERE idFollower <> @idInfluencer
	)
    GROUP BY P.IdProduct, P.labelProduct;
	
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluence].[@idInfluencer]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE].[Niveau]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluence].[@profondeur]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[labelProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE].[idUser]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idUser]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE].[idFollower]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idFollower]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluence].[CTE1].[FollowerCTE].[Niveau]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetInfluence].[@idInfluencer]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetInfluence].[@profondeur]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="179" />
				<Property Name="Length" Value="904" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: requête 1&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[GetInfluence]&#xD;&#xA;(&#xD;&#xA;&#x9;@idInfluencer&#x9;int, &#xD;&#xA;&#x9;@profondeur&#x9;int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GetInfluenceByProduct]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;
	WITH FollowerCTE AS
	(
		-- On démarre avec le user de base
		SELECT F1.*, 1 AS Niveau
		FROM Followers F1
		WHERE F1.idUser = @idInfluencer

		UNION ALL

		SELECT F2.*, Niveau+1
		FROM Followers F2
		INNER JOIN FollowerCTE follows ON follows.idFollower = F2.idUser
		WHERE Niveau < @profondeur
	)

	SELECT DISTINCT P.*, COUNT(P.IdProduct)
    FROM Products P
    JOIN Purchases Pr on Pr.IdProduct = P.IdProduct
    WHERE Pr.idProduct=@idProduit AND Pr.idUser IN (
		SELECT DISTINCT idFollower FROM FollowerCTE
		WHERE idFollower <> @idInfluencer
	)
    GROUP BY P.IdProduct, P.labelProduct;
	
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluenceByProduct].[@idInfluencer]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE].[Niveau]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluenceByProduct].[@profondeur]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetInfluenceByProduct].[@idProduit]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[labelProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE].[idUser]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idUser]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE].[idFollower]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idFollower]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetInfluenceByProduct].[CTE1].[FollowerCTE].[Niveau]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetInfluenceByProduct].[@idInfluencer]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetInfluenceByProduct].[@profondeur]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetInfluenceByProduct].[@idProduit]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="179" />
				<Property Name="Length" Value="946" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: requête 1&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[GetInfluenceByProduct]&#xD;&#xA;(&#xD;&#xA;&#x9;@idInfluencer&#x9;int &#xD;&#xA;&#x9;,@profondeur&#x9;int&#xD;&#xA;&#x9;,@idProduit&#x9;&#x9;int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[GetViralProduct]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;
	WITH FollowerCTE AS
            (
            -- On démarre avec les user qui ont achetés le produit
            select F1.*,1 AS Niveau
            FROM Followers F1
            WHERE F1.idUser in (select pr.idUser from purchases pr where pr.idProduct=@idProduit)

            UNION ALL

            select F2.idFollower , cte.idUser ,Niveau+1 as Niveau
            FROM Followers F2
            INNER JOIN FollowerCTE cte ON cte.idFollower = F2.idUser
            WHERE niveau < @profondeur
        )

        select P.idProduct, P.labelProduct, COUNT(DISTINCT CONCAT(F.idFollower, F.idUser, F.Niveau))
        from FollowerCTE F, products P
        where F.Niveau = @profondeur and P.idProduct = @idProduit and F.idFollower != F.idUser and  F.idFollower in (Select distinct PR.idUser
                                                                FROM Products P
                                                                JOIN Purchases Pr on Pr.IdProduct = P.IdProduct
                                                                WHERE P.IdProduct = @idProduit)
		GROUP BY P.idProduct, P.labelProduct
	
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[@idProduit]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[Niveau]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[Niveau]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[GetViralProduct].[@profondeur]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[labelProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idFollower]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[followers].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[purchases].[idUser]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[idUser]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idUser]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[idFollower]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[dbo].[followers].[idFollower]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[dbo].[GetViralProduct].[CTE1].[FollowerCTE].[Niveau]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetViralProduct].[@profondeur]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[GetViralProduct].[@idProduit]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="179" />
				<Property Name="Length" Value="1438" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: requête 3&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[GetViralProduct]&#xD;&#xA;(&#xD;&#xA;&#x9;@profondeur&#x9;int&#xD;&#xA;&#x9;,@idProduit&#x9;int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[MassiveProductsInsertion]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;
	DECLARE @compteur INT = 0;
        while (@compteur <= @nbOfRows)
		BEGIN 
                insert into products (idProduct, labelProduct) values (ABS(CHECKSUM(NEWID())), @compteur);
                SET @compteur += 1;
        END 
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[MassiveProductsInsertion].[@nbOfRows]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[idProduct]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[products].[labelProduct]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[MassiveProductsInsertion].[@nbOfRows]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="188" />
				<Property Name="Length" Value="534" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: insertion produits&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[MassiveProductsInsertion]&#xD;&#xA;(&#xD;&#xA;&#x9;@nbOfRows&#x9;int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[MassiveUsersInsertion]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
    SET NOCOUNT ON;
	DECLARE @compteur INT = 0;
        while (@compteur <= @nbOfRows)
		BEGIN 
            insert into users (idUser, username) values (ABS(CHECKSUM(NEWID())), @compteur);
            SET @compteur += 1;
        END 
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[MassiveUsersInsertion].[@nbOfRows]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users].[idUser]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[users].[username]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[dbo].[MassiveUsersInsertion].[@nbOfRows]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="188" />
				<Property Name="Length" Value="513" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;-- =============================================&#xD;&#xA;-- Author:      Luna&#xD;&#xA;-- Create Date: 01/03/2023&#xD;&#xA;-- Description: insertion produits&#xD;&#xA;-- =============================================&#xD;&#xA;CREATE PROCEDURE [dbo].[MassiveUsersInsertion]&#xD;&#xA;(&#xD;&#xA;&#x9;@nbOfRows&#x9;int&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Users_Products]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[purchases].[idUser]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[purchases].[idProduct]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[purchases]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="10" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Users_Users]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[followers].[idUser]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[followers].[idFollower]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[followers]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="9" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[products]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[products].[idProduct]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[products].[labelProduct]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="3" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[purchases]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[purchases].[idUser]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[purchases].[idProduct]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="10" />
			<AttachedAnnotation Disambiguator="7" />
			<AttachedAnnotation Disambiguator="8" />
		</Element>
		<Element Type="SqlTable" Name="[dbo].[users]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[users].[idUser]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[users].[username]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="4" />
		</Element>
	</Model>
</DataSchemaModel>